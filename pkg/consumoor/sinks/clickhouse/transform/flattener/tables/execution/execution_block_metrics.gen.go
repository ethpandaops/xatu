// Code generated by chgo-rowgen; DO NOT EDIT.

package execution

import (
	"net"

	"github.com/ClickHouse/ch-go/proto"
	"github.com/ethpandaops/xatu/pkg/consumoor/sinks/clickhouse/transform/flattener"
	"github.com/ethpandaops/xatu/pkg/consumoor/sinks/clickhouse/transform/metadata"
)

const executionBlockMetricsTableName flattener.TableName = "execution_block_metrics"

type executionBlockMetricsBatch struct {
	UpdatedDateTime                           proto.ColDateTime
	EventDateTime                             proto.ColDateTime64
	Source                                    proto.ColStr
	BlockNumber                               proto.ColUInt64
	BlockHash                                 flattener.SafeColFixedStr
	GasUsed                                   proto.ColUInt64
	TxCount                                   proto.ColUInt32
	ExecutionMs                               proto.ColFloat64
	StateReadMs                               proto.ColFloat64
	StateHashMs                               proto.ColFloat64
	CommitMs                                  proto.ColFloat64
	TotalMs                                   proto.ColFloat64
	MgasPerSec                                proto.ColFloat64
	StateReadsAccounts                        proto.ColUInt64
	StateReadsStorageSlots                    proto.ColUInt64
	StateReadsCode                            proto.ColUInt64
	StateReadsCodeBytes                       proto.ColUInt64
	StateWritesAccounts                       proto.ColUInt64
	StateWritesAccountsDeleted                proto.ColUInt64
	StateWritesStorageSlots                   proto.ColUInt64
	StateWritesStorageSlotsDeleted            proto.ColUInt64
	StateWritesCode                           proto.ColUInt64
	StateWritesCodeBytes                      proto.ColUInt64
	AccountCacheHits                          proto.ColInt64
	AccountCacheMisses                        proto.ColInt64
	AccountCacheHitRate                       proto.ColFloat64
	StorageCacheHits                          proto.ColInt64
	StorageCacheMisses                        proto.ColInt64
	StorageCacheHitRate                       proto.ColFloat64
	CodeCacheHits                             proto.ColInt64
	CodeCacheMisses                           proto.ColInt64
	CodeCacheHitRate                          proto.ColFloat64
	CodeCacheHitBytes                         proto.ColInt64
	CodeCacheMissBytes                        proto.ColInt64
	MetaClientName                            proto.ColStr
	MetaClientID                              proto.ColStr
	MetaClientVersion                         proto.ColStr
	MetaClientImplementation                  proto.ColStr
	MetaClientOS                              proto.ColStr
	MetaClientIP                              *proto.ColNullable[proto.IPv6]
	MetaClientGeoCity                         proto.ColStr
	MetaClientGeoCountry                      proto.ColStr
	MetaClientGeoCountryCode                  proto.ColStr
	MetaClientGeoContinentCode                proto.ColStr
	MetaClientGeoLongitude                    *proto.ColNullable[float64]
	MetaClientGeoLatitude                     *proto.ColNullable[float64]
	MetaClientGeoAutonomousSystemNumber       *proto.ColNullable[uint32]
	MetaClientGeoAutonomousSystemOrganization *proto.ColNullable[string]
	MetaNetworkID                             proto.ColInt32
	MetaNetworkName                           proto.ColStr
	MetaLabels                                *proto.ColMap[string, string]
	rows                                      int
}

func newexecutionBlockMetricsBatch() *executionBlockMetricsBatch {
	return &executionBlockMetricsBatch{
		EventDateTime:                             func() proto.ColDateTime64 { var c proto.ColDateTime64; c.WithPrecision(proto.Precision(3)); return c }(),
		BlockHash:                                 func() flattener.SafeColFixedStr { var c flattener.SafeColFixedStr; c.SetSize(66); return c }(),
		MetaClientIP:                              new(proto.ColIPv6).Nullable(),
		MetaClientGeoLongitude:                    new(proto.ColFloat64).Nullable(),
		MetaClientGeoLatitude:                     new(proto.ColFloat64).Nullable(),
		MetaClientGeoAutonomousSystemNumber:       new(proto.ColUInt32).Nullable(),
		MetaClientGeoAutonomousSystemOrganization: new(proto.ColStr).Nullable(),
		MetaLabels:                                proto.NewMap[string, string](new(proto.ColStr), new(proto.ColStr)),
	}
}

func (b *executionBlockMetricsBatch) Rows() int {
	return b.rows
}

func (b *executionBlockMetricsBatch) appendMetadata(meta *metadata.CommonMetadata) {
	if meta == nil {
		b.MetaClientName.Append("")
		b.MetaClientID.Append("")
		b.MetaClientVersion.Append("")
		b.MetaClientImplementation.Append("")
		b.MetaClientOS.Append("")
		b.MetaClientIP.Append(proto.Nullable[proto.IPv6]{})
		b.MetaClientGeoCity.Append("")
		b.MetaClientGeoCountry.Append("")
		b.MetaClientGeoCountryCode.Append("")
		b.MetaClientGeoContinentCode.Append("")
		b.MetaClientGeoLongitude.Append(proto.Nullable[float64]{})
		b.MetaClientGeoLatitude.Append(proto.Nullable[float64]{})
		b.MetaClientGeoAutonomousSystemNumber.Append(proto.Nullable[uint32]{})
		b.MetaClientGeoAutonomousSystemOrganization.Append(proto.Nullable[string]{})
		b.MetaNetworkID.Append(0)
		b.MetaNetworkName.Append("")
		b.MetaLabels.Append(nil)
		return
	}

	b.MetaClientName.Append(meta.MetaClientName)
	b.MetaClientID.Append(meta.MetaClientID)
	b.MetaClientVersion.Append(meta.MetaClientVersion)
	b.MetaClientImplementation.Append(meta.MetaClientImplementation)
	b.MetaClientOS.Append(meta.MetaClientOS)
	b.MetaClientIP.Append(proto.NewNullable[proto.IPv6](flattener.ParseIPv6(meta.MetaClientIP)))
	b.MetaClientGeoCity.Append(meta.MetaClientGeoCity)
	b.MetaClientGeoCountry.Append(meta.MetaClientGeoCountry)
	b.MetaClientGeoCountryCode.Append(meta.MetaClientGeoCountryCode)
	b.MetaClientGeoContinentCode.Append(meta.MetaClientGeoContinentCode)
	b.MetaClientGeoLongitude.Append(proto.NewNullable[float64](meta.MetaClientGeoLongitude))
	b.MetaClientGeoLatitude.Append(proto.NewNullable[float64](meta.MetaClientGeoLatitude))
	b.MetaClientGeoAutonomousSystemNumber.Append(proto.NewNullable[uint32](meta.MetaClientGeoAutonomousSystemNumber))
	b.MetaClientGeoAutonomousSystemOrganization.Append(proto.NewNullable[string](meta.MetaClientGeoAutonomousSystemOrganization))
	b.MetaNetworkID.Append(int32(meta.MetaNetworkID))
	b.MetaNetworkName.Append(meta.MetaNetworkName)
	if meta.MetaLabels != nil {
		b.MetaLabels.Append(meta.MetaLabels)
	} else {
		b.MetaLabels.Append(map[string]string{})
	}
}

func (b *executionBlockMetricsBatch) Input() proto.Input {
	return proto.Input{
		{Name: "updated_date_time", Data: &b.UpdatedDateTime},
		{Name: "event_date_time", Data: &b.EventDateTime},
		{Name: "source", Data: &b.Source},
		{Name: "block_number", Data: &b.BlockNumber},
		{Name: "block_hash", Data: &b.BlockHash},
		{Name: "gas_used", Data: &b.GasUsed},
		{Name: "tx_count", Data: &b.TxCount},
		{Name: "execution_ms", Data: &b.ExecutionMs},
		{Name: "state_read_ms", Data: &b.StateReadMs},
		{Name: "state_hash_ms", Data: &b.StateHashMs},
		{Name: "commit_ms", Data: &b.CommitMs},
		{Name: "total_ms", Data: &b.TotalMs},
		{Name: "mgas_per_sec", Data: &b.MgasPerSec},
		{Name: "state_reads_accounts", Data: &b.StateReadsAccounts},
		{Name: "state_reads_storage_slots", Data: &b.StateReadsStorageSlots},
		{Name: "state_reads_code", Data: &b.StateReadsCode},
		{Name: "state_reads_code_bytes", Data: &b.StateReadsCodeBytes},
		{Name: "state_writes_accounts", Data: &b.StateWritesAccounts},
		{Name: "state_writes_accounts_deleted", Data: &b.StateWritesAccountsDeleted},
		{Name: "state_writes_storage_slots", Data: &b.StateWritesStorageSlots},
		{Name: "state_writes_storage_slots_deleted", Data: &b.StateWritesStorageSlotsDeleted},
		{Name: "state_writes_code", Data: &b.StateWritesCode},
		{Name: "state_writes_code_bytes", Data: &b.StateWritesCodeBytes},
		{Name: "account_cache_hits", Data: &b.AccountCacheHits},
		{Name: "account_cache_misses", Data: &b.AccountCacheMisses},
		{Name: "account_cache_hit_rate", Data: &b.AccountCacheHitRate},
		{Name: "storage_cache_hits", Data: &b.StorageCacheHits},
		{Name: "storage_cache_misses", Data: &b.StorageCacheMisses},
		{Name: "storage_cache_hit_rate", Data: &b.StorageCacheHitRate},
		{Name: "code_cache_hits", Data: &b.CodeCacheHits},
		{Name: "code_cache_misses", Data: &b.CodeCacheMisses},
		{Name: "code_cache_hit_rate", Data: &b.CodeCacheHitRate},
		{Name: "code_cache_hit_bytes", Data: &b.CodeCacheHitBytes},
		{Name: "code_cache_miss_bytes", Data: &b.CodeCacheMissBytes},
		{Name: "meta_client_name", Data: &b.MetaClientName},
		{Name: "meta_client_id", Data: &b.MetaClientID},
		{Name: "meta_client_version", Data: &b.MetaClientVersion},
		{Name: "meta_client_implementation", Data: &b.MetaClientImplementation},
		{Name: "meta_client_os", Data: &b.MetaClientOS},
		{Name: "meta_client_ip", Data: b.MetaClientIP},
		{Name: "meta_client_geo_city", Data: &b.MetaClientGeoCity},
		{Name: "meta_client_geo_country", Data: &b.MetaClientGeoCountry},
		{Name: "meta_client_geo_country_code", Data: &b.MetaClientGeoCountryCode},
		{Name: "meta_client_geo_continent_code", Data: &b.MetaClientGeoContinentCode},
		{Name: "meta_client_geo_longitude", Data: b.MetaClientGeoLongitude},
		{Name: "meta_client_geo_latitude", Data: b.MetaClientGeoLatitude},
		{Name: "meta_client_geo_autonomous_system_number", Data: b.MetaClientGeoAutonomousSystemNumber},
		{Name: "meta_client_geo_autonomous_system_organization", Data: b.MetaClientGeoAutonomousSystemOrganization},
		{Name: "meta_network_id", Data: &b.MetaNetworkID},
		{Name: "meta_network_name", Data: &b.MetaNetworkName},
		{Name: "meta_labels", Data: b.MetaLabels},
	}
}

func (b *executionBlockMetricsBatch) Reset() {
	b.UpdatedDateTime.Reset()
	b.EventDateTime.Reset()
	b.Source.Reset()
	b.BlockNumber.Reset()
	b.BlockHash.Reset()
	b.GasUsed.Reset()
	b.TxCount.Reset()
	b.ExecutionMs.Reset()
	b.StateReadMs.Reset()
	b.StateHashMs.Reset()
	b.CommitMs.Reset()
	b.TotalMs.Reset()
	b.MgasPerSec.Reset()
	b.StateReadsAccounts.Reset()
	b.StateReadsStorageSlots.Reset()
	b.StateReadsCode.Reset()
	b.StateReadsCodeBytes.Reset()
	b.StateWritesAccounts.Reset()
	b.StateWritesAccountsDeleted.Reset()
	b.StateWritesStorageSlots.Reset()
	b.StateWritesStorageSlotsDeleted.Reset()
	b.StateWritesCode.Reset()
	b.StateWritesCodeBytes.Reset()
	b.AccountCacheHits.Reset()
	b.AccountCacheMisses.Reset()
	b.AccountCacheHitRate.Reset()
	b.StorageCacheHits.Reset()
	b.StorageCacheMisses.Reset()
	b.StorageCacheHitRate.Reset()
	b.CodeCacheHits.Reset()
	b.CodeCacheMisses.Reset()
	b.CodeCacheHitRate.Reset()
	b.CodeCacheHitBytes.Reset()
	b.CodeCacheMissBytes.Reset()
	b.MetaClientName.Reset()
	b.MetaClientID.Reset()
	b.MetaClientVersion.Reset()
	b.MetaClientImplementation.Reset()
	b.MetaClientOS.Reset()
	b.MetaClientIP.Reset()
	b.MetaClientGeoCity.Reset()
	b.MetaClientGeoCountry.Reset()
	b.MetaClientGeoCountryCode.Reset()
	b.MetaClientGeoContinentCode.Reset()
	b.MetaClientGeoLongitude.Reset()
	b.MetaClientGeoLatitude.Reset()
	b.MetaClientGeoAutonomousSystemNumber.Reset()
	b.MetaClientGeoAutonomousSystemOrganization.Reset()
	b.MetaNetworkID.Reset()
	b.MetaNetworkName.Reset()
	b.MetaLabels.Reset()
	b.rows = 0
}

func (b *executionBlockMetricsBatch) Snapshot() []map[string]any {
	n := b.rows
	out := make([]map[string]any, n)

	for i := 0; i < n; i++ {
		row := make(map[string]any, 51)
		row["updated_date_time"] = b.UpdatedDateTime.Row(i).Unix()
		row["event_date_time"] = b.EventDateTime.Row(i).UnixMilli()
		row["source"] = b.Source.Row(i)
		row["block_number"] = b.BlockNumber.Row(i)
		row["block_hash"] = string(b.BlockHash.Row(i))
		row["gas_used"] = b.GasUsed.Row(i)
		row["tx_count"] = b.TxCount.Row(i)
		row["execution_ms"] = b.ExecutionMs.Row(i)
		row["state_read_ms"] = b.StateReadMs.Row(i)
		row["state_hash_ms"] = b.StateHashMs.Row(i)
		row["commit_ms"] = b.CommitMs.Row(i)
		row["total_ms"] = b.TotalMs.Row(i)
		row["mgas_per_sec"] = b.MgasPerSec.Row(i)
		row["state_reads_accounts"] = b.StateReadsAccounts.Row(i)
		row["state_reads_storage_slots"] = b.StateReadsStorageSlots.Row(i)
		row["state_reads_code"] = b.StateReadsCode.Row(i)
		row["state_reads_code_bytes"] = b.StateReadsCodeBytes.Row(i)
		row["state_writes_accounts"] = b.StateWritesAccounts.Row(i)
		row["state_writes_accounts_deleted"] = b.StateWritesAccountsDeleted.Row(i)
		row["state_writes_storage_slots"] = b.StateWritesStorageSlots.Row(i)
		row["state_writes_storage_slots_deleted"] = b.StateWritesStorageSlotsDeleted.Row(i)
		row["state_writes_code"] = b.StateWritesCode.Row(i)
		row["state_writes_code_bytes"] = b.StateWritesCodeBytes.Row(i)
		row["account_cache_hits"] = b.AccountCacheHits.Row(i)
		row["account_cache_misses"] = b.AccountCacheMisses.Row(i)
		row["account_cache_hit_rate"] = b.AccountCacheHitRate.Row(i)
		row["storage_cache_hits"] = b.StorageCacheHits.Row(i)
		row["storage_cache_misses"] = b.StorageCacheMisses.Row(i)
		row["storage_cache_hit_rate"] = b.StorageCacheHitRate.Row(i)
		row["code_cache_hits"] = b.CodeCacheHits.Row(i)
		row["code_cache_misses"] = b.CodeCacheMisses.Row(i)
		row["code_cache_hit_rate"] = b.CodeCacheHitRate.Row(i)
		row["code_cache_hit_bytes"] = b.CodeCacheHitBytes.Row(i)
		row["code_cache_miss_bytes"] = b.CodeCacheMissBytes.Row(i)
		row["meta_client_name"] = b.MetaClientName.Row(i)
		row["meta_client_id"] = b.MetaClientID.Row(i)
		row["meta_client_version"] = b.MetaClientVersion.Row(i)
		row["meta_client_implementation"] = b.MetaClientImplementation.Row(i)
		row["meta_client_os"] = b.MetaClientOS.Row(i)
		if v := b.MetaClientIP.Row(i); v.Set {
			row["meta_client_ip"] = net.IP(v.Value[:]).String()
		} else {
			row["meta_client_ip"] = nil
		}
		row["meta_client_geo_city"] = b.MetaClientGeoCity.Row(i)
		row["meta_client_geo_country"] = b.MetaClientGeoCountry.Row(i)
		row["meta_client_geo_country_code"] = b.MetaClientGeoCountryCode.Row(i)
		row["meta_client_geo_continent_code"] = b.MetaClientGeoContinentCode.Row(i)
		if v := b.MetaClientGeoLongitude.Row(i); v.Set {
			row["meta_client_geo_longitude"] = v.Value
		} else {
			row["meta_client_geo_longitude"] = nil
		}
		if v := b.MetaClientGeoLatitude.Row(i); v.Set {
			row["meta_client_geo_latitude"] = v.Value
		} else {
			row["meta_client_geo_latitude"] = nil
		}
		if v := b.MetaClientGeoAutonomousSystemNumber.Row(i); v.Set {
			row["meta_client_geo_autonomous_system_number"] = v.Value
		} else {
			row["meta_client_geo_autonomous_system_number"] = nil
		}
		if v := b.MetaClientGeoAutonomousSystemOrganization.Row(i); v.Set {
			row["meta_client_geo_autonomous_system_organization"] = v.Value
		} else {
			row["meta_client_geo_autonomous_system_organization"] = nil
		}
		row["meta_network_id"] = b.MetaNetworkID.Row(i)
		row["meta_network_name"] = b.MetaNetworkName.Row(i)
		row["meta_labels"] = b.MetaLabels.Row(i)
		out[i] = row
	}

	return out
}
