// Code generated by chgo-rowgen; DO NOT EDIT.

package libp2p

import (
	"github.com/ClickHouse/ch-go/proto"
	"github.com/ethpandaops/xatu/pkg/consumoor/sinks/clickhouse/transform/flattener"
	"github.com/ethpandaops/xatu/pkg/consumoor/sinks/clickhouse/transform/metadata"
)

const libp2pPeerTableName flattener.TableName = "libp2p_peer"

type libp2pPeerBatch struct {
	UniqueKey       proto.ColInt64
	UpdatedDateTime proto.ColDateTime
	PeerID          proto.ColStr
	MetaNetworkID   proto.ColInt32
	MetaNetworkName proto.ColStr
	rows            int
}

func newlibp2pPeerBatch() *libp2pPeerBatch {
	return &libp2pPeerBatch{}
}

func (b *libp2pPeerBatch) Rows() int {
	return b.rows
}

func (b *libp2pPeerBatch) appendMetadata(meta *metadata.CommonMetadata) {
	if meta == nil {
		b.MetaNetworkID.Append(0)
		b.MetaNetworkName.Append("")
		return
	}

	b.MetaNetworkID.Append(int32(meta.MetaNetworkID))
	b.MetaNetworkName.Append(meta.MetaNetworkName)
}

func (b *libp2pPeerBatch) Input() proto.Input {
	return proto.Input{
		{Name: "unique_key", Data: &b.UniqueKey},
		{Name: "updated_date_time", Data: &b.UpdatedDateTime},
		{Name: "peer_id", Data: &b.PeerID},
		{Name: "meta_network_id", Data: &b.MetaNetworkID},
		{Name: "meta_network_name", Data: &b.MetaNetworkName},
	}
}

func (b *libp2pPeerBatch) Reset() {
	b.UniqueKey.Reset()
	b.UpdatedDateTime.Reset()
	b.PeerID.Reset()
	b.MetaNetworkID.Reset()
	b.MetaNetworkName.Reset()
	b.rows = 0
}

func (b *libp2pPeerBatch) Snapshot() []map[string]any {
	n := b.rows
	out := make([]map[string]any, n)

	for i := 0; i < n; i++ {
		row := make(map[string]any, 5)
		row["unique_key"] = b.UniqueKey.Row(i)
		row["updated_date_time"] = b.UpdatedDateTime.Row(i).Unix()
		row["peer_id"] = b.PeerID.Row(i)
		row["meta_network_id"] = b.MetaNetworkID.Row(i)
		row["meta_network_name"] = b.MetaNetworkName.Row(i)
		out[i] = row
	}

	return out
}
